<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Decision</title>

  <!-- APPLY SITE THEME -->
  <link rel="stylesheet" href="style.css" />
</head>

<body class="wnp">
  <div class="wrap">

    <div class="hero">
      <!-- ✅ Brand with red accent line under WE NOT -->
      <div class="brand-wrap brand-offset">
        <span class="brand">WE NOT POOR</span>
        <span class="brand-accent" aria-hidden="true"></span>
      </div>

      <h1>Check Status</h1>
      <p class="sub">Log in to view your current status.</p>
    </div>

    <div class="card status-login-card">
      <div class="card-h"></div>

      <div class="row status-login-row">
        <div class="field">
        <span>Email <span class="req">*</span></span>
        <input id="email" type="email" autocomplete="email" />
        </div>

        <div class="field">
        <span>Password <span class="req">*</span></span>
        <input id="password" type="password" autocomplete="current-password" />
        </div>

        <div class="actions">
          <button id="loginBtn" class="btn">Log In</button>
        </div>

        <div id="msg" class="result err" style="display:none;"></div>
      </div>
    </div>

    <div id="statusCard" class="card" style="display:none;">
      <div class="card-h">
        <div class="card-title">STATUS</div>
        <div id="statusPill" class="pill" style="display:none;"></div>
      </div>

      <h2 id="statusTitle" style="margin:6px 0 8px;"></h2>
      <p id="statusText" class="note" style="margin:0;"></p>

      <div id="deniedReasonWrap" class="result err" style="display:none; margin-top:12px;">
        <div id="deniedReason"></div>
      </div>

      <div class="actions">
        <button id="enterBtn" class="btn" style="display:none;">ENTER</button>
        <a href="index.html" class="btn ghost">Back</a>
      </div>
    </div>

    <!-- ✅ Footer: centered single line only -->
    <div class="foot foot-center">
      <span>Membership is not open. It is earned.</span>
    </div>

  </div>

  <!-- ✅ Page-specific layout fixes (doesn't affect other pages) -->
  <style>
    /* Make the input wells proportionate (not full-width) */
    .status-login-row .field{
      width: 100%;
      max-width: 520px;
      margin-left: auto;
      margin-right: auto;
    }

    .status-login-row input{ width: 100%; }

    .status-login-row .actions{ justify-content: center; }

    .foot-center{
      justify-content: center !important;
      text-align: center;
    }

    /* ✅ Red accent line under WE NOT (left-aligned under WE NOT) */
    .brand-wrap{
      display: inline-flex;
      flex-direction: column;
      gap: 4px;
    }
    .brand-offset{ align-items: flex-start; }

    .brand-accent{
      display:block;
      width:36px;             /* smaller than the word */
      height:3px;
      background: var(--danger, #FF2A2A);
      border-radius: 999px;
      margin-left: 2px;       /* optical alignment under WE NOT */
    }
  </style>

  <script>
    const API_BASE = "";
    const $ = (id) => document.getElementById(id);

    const showMsg = (t="") => {
      const el = $("msg");
      if (!t) { el.style.display = "none"; el.textContent = ""; return; }
      el.style.display = "block";
      el.textContent = t;
    };

    function setPill(text, variant) {
      const pill = $("statusPill");
      pill.style.display = "inline-flex";
      pill.className = "pill" + (variant ? ` ${variant}` : "");
      pill.textContent = text;
    }

    function showStatus(status, reason) {
      $("statusCard").style.display = "block";
      $("deniedReasonWrap").style.display = "none";
      $("enterBtn").style.display = "none";

      if (status === "pending") {
        setPill("PENDING");
        $("statusTitle").textContent = "Pending Activation";
        $("statusText").textContent = "Your submission is under review. Access is granted only after approval.";
      } else if (status === "approved") {
        setPill("APPROVED", "good");
        $("statusTitle").textContent = "Approved";
        $("statusText").textContent = "You’re approved. Select ENTER to continue to the Oath.";
        $("enterBtn").style.display = "inline-block";
      } else if (status === "auto_approved") {
        setPill("APPROVED", "good");
        $("statusTitle").textContent = "Approved";
        $("statusText").textContent = "Continue to the Oath.";
        $("enterBtn").style.display = "inline-block";
      } else if (status === "denied") {
        setPill("DENIED");
        $("statusTitle").textContent = "Denied";
        $("statusText").textContent = "Your request was denied.";
        $("deniedReasonWrap").style.display = "block";
        $("deniedReason").textContent = reason ? `Reason: ${reason}` : "Reason: (not provided)";
      } else if (status === "active") {
        setPill("ACTIVE", "good");
        $("statusTitle").textContent = "Active";
        $("statusText").textContent = "You already have access. Redirecting…";
        setTimeout(() => location.href = "/member.html", 600);
      } else {
        setPill(String(status || "UNKNOWN"));
        $("statusTitle").textContent = "Status";
        $("statusText").textContent = `Current status: ${status}`;
      }
    }

    $("loginBtn").addEventListener("click", async () => {
      showMsg("");
      const email = $("email").value.trim().toLowerCase();
      const password = $("password").value;

      if (!email || !password) return showMsg("Email and password are required.");

      const res = await fetch(`${API_BASE}/api/auth/login`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ email, password })
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        if (data && data.status === "denied") {
          showStatus("denied", data.reason);
          return;
        }
        return showMsg(data.error || "Login failed.");
      }

      showStatus(data.status, data.reason);
    });

    $("enterBtn").addEventListener("click", () => {
      location.href = "/oath.html";
    });
  </script>
</body>
</html>
