<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Name · WE NOT POOR</title>

  <!-- If you already use a shared CSS file, keep this link -->
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* Fallback styling if styles.css isn’t present on this page yet */
    :root{
      --bg:#000;
      --yellow:#FFD400;
      --danger:#FF2A2A;
      --panel:#0b0b0b;
      --muted:rgba(255,212,0,.72);
      --radius:16px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    body{
      margin:0;
      font-family:var(--font);
      background:var(--bg);
      color:var(--yellow);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:min(560px, 100%);
      background:var(--panel);
      border:1px solid rgba(255,212,0,.22);
      border-radius:var(--radius);
      padding:22px;
    }
    h1{margin:0 0 8px; font-size:22px;}
    p{margin:0 0 16px; color:var(--muted); line-height:1.35;}
    label{display:block; margin:12px 0 6px; font-size:14px; color:var(--muted);}
    input{
      width:100%;
      padding:14px 12px;
      border-radius:12px;
      border:1px solid rgba(255,212,0,.35);
      background:#000;
      color:var(--yellow);
      outline:none;
      font-size:16px;
    }
    input::placeholder{color:rgba(255,212,0,.35);}
    .row{display:flex; gap:12px; margin-top:14px; flex-wrap:wrap;}
    button{
      appearance:none;
      border:none;
      border-radius:12px;
      padding:14px 14px;
      font-weight:800;
      cursor:pointer;
      background:var(--yellow);
      color:#000;
      width:100%;
      font-size:16px;
    }
    .msg{
      margin-top:12px;
      font-size:14px;
      color:var(--danger);
      min-height:18px;
    }
    .small{
      margin-top:10px;
      font-size:12px;
      color:rgba(255,212,0,.5);
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>One thing before you enter.</h1>
    <p>This is not a profile. This is accountability. Put your first name.</p>

    <label for="firstName">First name</label>
    <input id="firstName" type="text" placeholder="First name" autocomplete="given-name" />

    <div class="row">
      <button id="saveBtn">ENTER</button>
    </div>

    <div id="msg" class="msg"></div>
    <div class="small">You can change this later in a future update if you decide. For now: keep it real.</div>
  </div>

  <script>
    const API_BASE = "https://wenotpoor.com";

    async function apiMe() {
      const r = await fetch(`${API_BASE}/api/auth/me`, { credentials: "include" });
      return r.json();
    }

    async function init() {
      const me = await apiMe();
      if (!me.authenticated) {
        window.location.href = "login.html"; // change if your login filename differs
        return;
      }
      if (me.status !== "active") {
        window.location.href = "decision.html";
        return;
      }
      if (me.first_name && me.first_name.trim()) {
        window.location.href = "member-access.html";
        return;
      }
    }

    async function saveName() {
      const msg = document.getElementById("msg");
      msg.textContent = "";

      const first_name = (document.getElementById("firstName").value || "").trim();
      if (!first_name) {
        msg.textContent = "First name required.";
        return;
      }

      const btn = document.getElementById("saveBtn");
      btn.disabled = true;
      btn.textContent = "SAVING...";

      try {
        const r = await fetch(`${API_BASE}/api/profile/first-name`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ first_name })
        });

        const data = await r.json().catch(() => ({}));
        if (!r.ok) {
          msg.textContent = data.error || "Could not save your name.";
          btn.disabled = false;
          btn.textContent = "ENTER";
          return;
        }

        window.location.href = "member-access.html";
      } catch (e) {
        msg.textContent = "Network error. Try again.";
        btn.disabled = false;
        btn.textContent = "ENTER";
      }
    }

    document.getElementById("saveBtn").addEventListener("click", saveName);
    document.getElementById("firstName").addEventListener("keydown", (e) => {
      if (e.key === "Enter") saveName();
    });

    init();
  </script>
</body>
</html>
